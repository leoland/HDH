var SimpleHistoryFilterDropin=function($){function e(){t(),a()}function i(){m(),r()}function t(){v.filter_container=$(".SimpleHistory__filters"),v.filter_user=v.filter_container.find(".SimpleHistory__filters__filter--user"),v.filter_button=v.filter_container.find(".js-SimpleHistoryFilterDropin-doFilter"),v.filter_form=v.filter_container.find(".js-SimpleHistory__filters__form"),v.show_more_filters_button=v.filter_container.find(".js-SimpleHistoryFilterDropin-showMoreFilters"),v.more_filters_container=v.filter_container.find(".js-SimpleHistory__filters__moreFilters")}function r(){v.filter_form.on("submit",n),v.show_more_filters_button.on("click",l)}function l(){v.filter_container.toggleClass("is-showingMoreFilters")}function o(){var e=v.filter_form.find("[name='search']"),i=v.filter_form.find("[name='loglevels']"),t=v.filter_form.find("[name='messages']"),r=v.filter_form.find("[name='users']"),l=v.filter_form.find("[name='dates']"),o=v.filter_form.find("[name='from_mm']"),n=v.filter_form.find("[name='from_jj']"),a=v.filter_form.find("[name='from_aa']"),s=v.filter_form.find("[name='to_mm']"),f=v.filter_form.find("[name='to_jj']"),_=v.filter_form.find("[name='to_aa']");p=!1,g={},$.trim(e.val())&&(p=!0,g.search=e.val()),i.val()&&i.val().length&&(p=!0,g.loglevels=i.val()),t.val()&&t.val().length&&(p=!0,g.messages=t.val()),$.trim(r.val())&&(p=!0,g.users=r.val()),l.val()&&l.val().length&&(p=!0,"customRange"==l.val()?(g.date_from=a.val()+"-"+o.val()+"-"+n.val()+" 00:00:00",g.date_to=_.val()+"-"+s.val()+"-"+f.val()+" 23:59:59"):g.dates=l.val())}function n(e){e.preventDefault(),simple_history.logRowsCollection.reload()}function a(){$(document).on("SimpleHistory:mainViewInitBeforeLoadRows",function(){simple_history.logRowsCollection.on("before_fetch",f)}),$(document).on("SimpleHistory:NewRowsNotifier:apiArgs",s)}function s(e,i){p&&(i=_.extend(i,g))}function f(e,i){o(),p&&(i=_.extend(i,g))}function m(){v.filter_user.select2({minimumInputLength:2,allowClear:!0,placeholder:"All users",ajax:{url:ajaxurl,dataType:"json",cache:!0,data:function(e,i){return{q:e,page_limit:10,action:"simple_history_filters_search_user"}},results:function(e,i){return e.data}},formatResult:u,initSelection:function(e,i){var t=$(e),r=t.val(),l=v.filter_user.data("default-user-data");i(l)},formatSelection:u,escapeMarkup:function(e){return e},multiple:!0}),$(".SimpleHistory__filters__filter--logger").select2({});var e=$(".SimpleHistory__filters__filter--date");e.select2({}),e.on("select2-selecting change",c),$(".SimpleHistory__filters__filter--loglevel").select2({formatResult:d,formatSelection:d,escapeMarkup:function(e){return e}})}function c(e,i){var t=$("select.SimpleHistory__filters__filter--date"),r=t.val();"customRange"===r?v.filter_container.addClass("is-customDateFilterActive"):v.filter_container.removeClass("is-customDateFilterActive")}function u(e){var i="";return i+="<div class='SimpleHistory__filters__userfilter__gravatar'>",i+=e.gravatar,i+="</div>",i+="<div class='SimpleHistory__filters__userfilter__primary'>",i+=e.user_email,i+="</div>",i+="<div class='SimpleHistory__filters__userfilter__secondary'>",i+=e.user_login,i+="</div>"}function d(e){var i=e.element,t=$(i),r=t.data("color"),l='<span style="border-radius: 50%; border: 1px solid rgba(0,0,0,.1); margin-right: 5px; width: .75em; height: .75em; line-height: 1; display: inline-block; background-color: '+t.data("color")+"; '\"></span>"+e.text;return l}var v={},p=!1,g={};return{init:e,onDomReadyInit:i,$elms:v}}(jQuery);SimpleHistoryFilterDropin.init(),jQuery(document).ready(function(){SimpleHistoryFilterDropin.onDomReadyInit()});