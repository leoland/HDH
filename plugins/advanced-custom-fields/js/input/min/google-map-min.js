!function($){acf.fields.google_map={$el:null,$input:null,o:{},api:{sensor:!1,libraries:"places"},ready:!1,geocoder:!1,map:!1,maps:{},set:function(e){return $.extend(this,e),this.$input=this.$el.find(".input-address"),this.o=acf.helpers.get_atts(this.$el),this.maps[this.o.id]&&(this.map=this.maps[this.o.id]),this},init:function(){this.geocoder||(this.geocoder=new google.maps.Geocoder),this.ready=!0,acf.helpers.is_clone_field(this.$input)||this.render()},render:function(){var e=this,t=this.$el,a={zoom:parseInt(this.o.zoom),center:new google.maps.LatLng(this.o.lat,this.o.lng),mapTypeId:google.maps.MapTypeId.ROADMAP};this.map=new google.maps.Map(this.$el.find(".canvas")[0],a);var o=new google.maps.places.Autocomplete(this.$el.find(".search")[0]);o.map=this.map,o.bindTo("bounds",this.map),this.map.marker=new google.maps.Marker({draggable:!0,raiseOnDrag:!0,map:this.map}),this.map.$el=this.$el;var i=this.$el.find(".input-lat").val(),s=this.$el.find(".input-lng").val();i&&s&&this.update(i,s).center(),google.maps.event.addListener(o,"place_changed",function(t){var a=this.map.$el,o=a.find(".search").val();a.find(".input-address").val(o),a.find(".title h4").text(o);var i=this.getPlace();if(i.geometry){var s=i.geometry.location.lat(),l=i.geometry.location.lng();e.set({$el:a}).update(s,l).center()}else e.geocoder.geocode({address:o},function(t,o){if(o!=google.maps.GeocoderStatus.OK)return void console.log("Geocoder failed due to: "+o);if(!t[0])return void console.log("No results found");i=t[0];var s=i.geometry.location.lat(),l=i.geometry.location.lng();e.set({$el:a}).update(s,l).center()})}),google.maps.event.addListener(this.map.marker,"dragend",function(){var t=this.map.$el,a=this.map.marker.getPosition(),o=a.lat(),i=a.lng();e.set({$el:t}).update(o,i).sync()}),google.maps.event.addListener(this.map,"click",function(t){var a=this.$el,o=t.latLng.lat(),i=t.latLng.lng();e.set({$el:a}).update(o,i).sync()}),this.maps[this.o.id]=this.map},update:function(e,t){var a=new google.maps.LatLng(e,t);return this.$el.find(".input-lat").val(e),this.$el.find(".input-lng").val(t).trigger("change"),this.map.marker.setPosition(a),this.map.marker.setVisible(!0),this.$el.addClass("active"),this.$el.closest(".field").removeClass("error"),this},center:function(){var e=this.map.marker.getPosition(),t=this.o.lat,a=this.o.lng;e&&(t=e.lat(),a=e.lng());var o=new google.maps.LatLng(t,a);this.map.setCenter(o)},sync:function(){var e=this.$el,t=this.map.marker.getPosition(),a=new google.maps.LatLng(t.lat(),t.lng());return this.geocoder.geocode({latLng:a},function(t,a){if(a!=google.maps.GeocoderStatus.OK)return void console.log("Geocoder failed due to: "+a);if(!t[0])return void console.log("No results found");var o=t[0];e.find(".title h4").text(o.formatted_address),e.find(".input-address").val(o.formatted_address).trigger("change")}),this},locate:function(){var e=this,t=this.$el;return navigator.geolocation?(t.find(".title h4").text(acf.l10n.google_map.locating+"..."),t.addClass("active"),void navigator.geolocation.getCurrentPosition(function(a){var o=a.coords.latitude,i=a.coords.longitude;e.set({$el:t}).update(o,i).sync().center()})):(alert(acf.l10n.google_map.browser_support),this)},clear:function(){this.$el.removeClass("active"),this.$el.find(".search").val(""),this.$el.find(".input-address").val(""),this.$el.find(".input-lat").val(""),this.$el.find(".input-lng").val(""),this.map.marker.setVisible(!1)},edit:function(){this.$el.removeClass("active");var e=this.$el.find(".title h4").text();this.$el.find(".search").val(e).focus()},refresh:function(){google.maps.event.trigger(this.map,"resize"),this.center()}},$(document).on("acf/setup_fields",function(e,t){var a=acf.fields.google_map,o=$(t).find(".acf-google-map");return!!o.exists()&&(acf.helpers.isset(window,"google","load")?acf.helpers.isset(window,"google","maps","places")?(o.each(function(){acf.fields.google_map.set({$el:$(this)}).init()}),!0):(google.load("maps","3",{other_params:$.param(a.api),callback:function(){o.each(function(){acf.fields.google_map.set({$el:$(this)}).init()})}}),!1):($.getScript("https://www.google.com/jsapi",function(){google.load("maps","3",{other_params:$.param(a.api),callback:function(){o.each(function(){acf.fields.google_map.set({$el:$(this)}).init()})}})}),!1))}),$(document).on("click",".acf-google-map .acf-sprite-remove",function(e){e.preventDefault(),acf.fields.google_map.set({$el:$(this).closest(".acf-google-map")}).clear(),$(this).blur()}),$(document).on("click",".acf-google-map .acf-sprite-locate",function(e){e.preventDefault(),acf.fields.google_map.set({$el:$(this).closest(".acf-google-map")}).locate(),$(this).blur()}),$(document).on("click",".acf-google-map .title h4",function(e){e.preventDefault(),acf.fields.google_map.set({$el:$(this).closest(".acf-google-map")}).edit()}),$(document).on("keydown",".acf-google-map .search",function(e){if(13==e.which)return!1}),$(document).on("blur",".acf-google-map .search",function(e){var t=$(this).closest(".acf-google-map");t.find(".input-lat").val()&&t.addClass("active")}),$(document).on("acf/fields/tab/show acf/conditional_logic/show",function(e,t){acf.fields.google_map.ready&&"google_map"==t.attr("data-field_type")&&acf.fields.google_map.set({$el:t.find(".acf-google-map")}).refresh()})}(jQuery);