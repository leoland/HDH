!function($){acf.fields.relationship={$el:null,$input:null,$left:null,$right:null,o:{},timeout:null,set:function(t){return $.extend(this,t),this.$input=this.$el.children('input[type="hidden"]'),this.$left=this.$el.find(".relationship_left"),this.$right=this.$el.find(".relationship_right"),this.o=acf.helpers.get_atts(this.$el),this},init:function(){var t=this;if(!acf.helpers.is_clone_field(this.$input)){this.$right.find(".relationship_list").height(this.$left.height()-2),this.$right.find(".relationship_list").sortable({axis:"y",items:"> li",forceHelperSize:!0,forcePlaceholderSize:!0,scroll:!0,update:function(){t.$input.trigger("change")}});var i=this.$el;this.$left.find(".relationship_list").scrollTop(0).on("scroll",function(e){if(!i.hasClass("loading")&&!i.hasClass("no-results")&&$(this).scrollTop()+$(this).innerHeight()>=$(this).get(0).scrollHeight){var s=parseInt(i.attr("data-paged"));i.attr("data-paged",s+1),t.set({$el:i}).fetch()}}),this.fetch()}},fetch:function(){var t=this,i=this.$el;i.addClass("loading"),$.ajax({url:acf.o.ajaxurl,type:"post",dataType:"json",data:$.extend({action:"acf/fields/relationship/query_posts",post_id:acf.o.post_id,nonce:acf.o.nonce},this.o),success:function(e){t.set({$el:i}).render(e)}})},render:function(t){var i=this;return this.$el.removeClass("no-results").removeClass("loading"),1==this.o.paged&&this.$el.find(".relationship_left li:not(.load-more)").remove(),t&&t.html?(this.$el.find(".relationship_left .load-more").before(t.html),t.next_page_exists||this.$el.addClass("no-results"),void this.$left.find("a").each(function(){var t=$(this).attr("data-post_id");i.$right.find('a[data-post_id="'+t+'"]').exists()&&$(this).parent().addClass("hide")})):void this.$el.addClass("no-results")},add:function(t){var i=t.attr("data-post_id"),e=t.html();if(this.$right.find("a").length>=this.o.max)return alert(acf.l10n.relationship.max.replace("{max}",this.o.max)),!1;if(t.parent().hasClass("hide"))return!1;t.parent().addClass("hide");var s=["<li>",'<a href="#" data-post_id="'+t.attr("data-post_id")+'">',t.html()+'<span class="acf-button-remove"></span>',"</a>",'<input type="hidden" name="'+this.$input.attr("name")+'[]" value="'+t.attr("data-post_id")+'" />',"</li>"].join("");this.$right.find(".relationship_list").append(s),this.$input.trigger("change"),this.$el.closest(".field").removeClass("error")},remove:function(t){t.parent().remove(),this.$left.find('a[data-post_id="'+t.attr("data-post_id")+'"]').parent("li").removeClass("hide"),this.$input.trigger("change")}},$(document).on("acf/setup_fields",function(t,i){$(i).find(".acf_relationship").each(function(){acf.fields.relationship.set({$el:$(this)}).init()})}),$(document).on("change",".acf_relationship .select-post_type",function(t){var i=$(this).val(),e=$(this).closest(".acf_relationship");e.attr("data-post_type",i),e.attr("data-paged",1),acf.fields.relationship.set({$el:e}).fetch()}),$(document).on("click",".acf_relationship .relationship_left .relationship_list a",function(t){t.preventDefault(),acf.fields.relationship.set({$el:$(this).closest(".acf_relationship")}).add($(this)),$(this).blur()}),$(document).on("click",".acf_relationship .relationship_right .relationship_list a",function(t){t.preventDefault(),acf.fields.relationship.set({$el:$(this).closest(".acf_relationship")}).remove($(this)),$(this).blur()}),$(document).on("keyup",".acf_relationship input.relationship_search",function(t){var i=$(this).val(),e=$(this).closest(".acf_relationship");e.attr("data-s",i),e.attr("data-paged",1),clearTimeout(acf.fields.relationship.timeout),acf.fields.relationship.timeout=setTimeout(function(){acf.fields.relationship.set({$el:e}).fetch()},500)}),$(document).on("keypress",".acf_relationship input.relationship_search",function(t){13==t.which&&t.preventDefault()})}(jQuery);